<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z64QZ77B6P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z64QZ77B6P');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://storage.googleapis.com; img-src 'self' data: https:; connect-src 'self' https://storage.googleapis.com;">
    <title>Court Schedule</title>
    <style>
        .time-slot.no-data {
            border-left: 5px solid #888;
            background-color: rgba(136, 136, 136, 0.03);
        }
        .court-info.no-data {
            color: #888;
            font-style: italic;
            display: flex;
        }
        .schedule-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 6px;
            min-width: 880px;
            overflow-x: auto;
            background-color: white;
        }
        .header-cell {
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
            background-color: #faf9fc;
        }
        .court-list-link {
            color: #002c5a;
            text-decoration: none;
            display: block;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .court-list-link:hover {
            background-color: #0366d6;
            color: white;
            text-decoration: none;
        }
        .court-list-link::after {
            content: "ü°Ü";
            font-size: 0.8em;
            margin-left: 4px;
            display: inline-block;
        }
        .time-header {
            padding: 15px 10px;
            text-align: center;
            background-color: white;
        }
        .date-subheader {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        .time-slot {
            position: relative;
            padding: 15px 10px;
            background-color: white;
            min-height: 80px;
            border: 1px solid #000000;
        }
        .time-column {
            padding: 15px 10px;
            background-color: white;
            display: flex;
            align-items: flex-start;
            font-size: 12px;
        }
        .court-info {
            font-size: 12px;
            line-height: 1.5;
        }
        .unavailable {
            border-left: 5px solid rgb(255,59,48,0.5);
        }
        .available {
            border-left: 5px solid rgb(52,199,89,0.5);
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .nav-button {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        .dropdown {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .expandCollapseAllOff {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .nav-button:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .nav-button:not(:disabled):hover {
            background-color: #e9ecef;
        }
        .current-week {
            font-size: 16px;
            font-weight: bold;
        }
        .court-location {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .court-number {
            display: inline-block;
            padding: 0 2px;
        }
        .court-numbers {
            display: none;
            margin-left: 10px;
            color: #666;
            font-size: 10px;
            line-height: 1.4;
        }
        .court-numbers.expanded {
            display: block;
        }
        .expand-icon {
            display: inline-block;
            width: 12px;
            margin-right: 4px;
            font-size: 10px;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .mobile-timeslot.no-data {
                border-left: 5px solid #888;
                background-color: rgba(136, 136, 136, 0.03);
            }

            .mobile-court-unavailable.no-data {
                color: #888;
                font-style: italic;
            }
            body {
                margin: 0;
                padding: 0;
            }
            
            .schedule-container {
                padding: 0;
            }
            
            .schedule-grid,
            .navigation {
                display: none; /* Hide desktop elements */
            }
            
            .mobile-view {
                width: 100%;
                overflow-x: hidden; /* Prevent horizontal scrolling of the entire view */
            }
            
            .mobile-header {
                position: sticky;
                top: 0;
                background: white;
                z-index: 100;
                border-bottom: 1px solid #eee;
                width: 100%;
                overflow: hidden; /* Contains the scrolling dates */
            }
            
            .mobile-nav {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 10px;
                border-bottom: 1px solid #eee;
                width: 100%;
                box-sizing: border-box; /* Include padding in width calculation */
            }
            
            .mobile-current-date {
                text-align: center;
                font-size: 14px;
                font-weight: 500;
                flex-grow: 1;
                padding: 0 10px;
            }
            
            .mobile-dates {
                display: flex;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 8px;
                padding: 10px;
                /* Add these properties to ensure proper width and scrolling */
                width: 100%;
                min-width: 0;
                margin: 0;
            }
            
            .mobile-dates::-webkit-scrollbar {
                display: none;
            }
            
            .date-tab {
                padding: 8px 12px;
                border: none;
                background: none;
                border-radius: 4px;
                font-size: 14px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                min-width: 60px;
                flex: 0 0 auto; /* This prevents the tabs from shrinking */
                cursor: pointer;
                white-space: nowrap; /* Prevents text wrapping */
            }
            
            .date-tab.active {
                background-color: #f0f0f0;
                font-weight: 500;
            }
            
            .date-tab .day {
                font-weight: 500;
            }
            .date-tab .date {
                font-size: 12px;
                color: #666;
            }
            .date-tab.active {
                border-bottom: 2px solid #000;
            }
            
            .mobile-timeslot {
                padding: 12px 16px; /* Increase horizontal padding */
                margin-bottom: 1px; /* Add slight separation between time slots */
            }
            
            .mobile-time {
                font-weight: 500;
                margin-bottom: 12px;
            }
            
            .mobile-court {
                width: 100%; /* Ensure full width */
            }
            
            .mobile-court-name {
                flex-grow: 1;
                font-weight: 500;
                font-size: 14px; /* Slightly larger font */
                padding-right: 12px; /* Add some space before the count */
                white-space: normal; /* Allow text to wrap if needed */
                line-height: 1.4; /* Better line height for readability */
            }
            
            .mobile-court-count {
                color: #666;
                font-size: 13px;
                white-space: nowrap; /* Keep the count on one line */
                padding-left: 8px; /* Space from the name */
            }
            
            .mobile-court-numbers {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                padding: 10px 0;
                margin-left: 24px; /* Align with the location name */
                width: calc(100% - 24px); /* Full width minus the left margin */
            }
            .mobile-court-chip {
                background-color: #f0f0f0;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 13px;
                color: #0366d6;
                display: inline-block;
                text-decoration: none;
                transition: all 0.2s ease;
                margin: 2px;
            }
            .mobile-court-chip:hover {
                background-color: #0366d6;
                color: white;
                transform: translateY(-1px);
            }
            .mobile-court-chip:active {
                transform: translateY(0);
            }
            .court-link::after,
            .mobile-court-chip::after {
                font-size: 0.8em;
                margin-left: 2px;
                display: inline-block;
            }
            .mobile-filter-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            }
			.mobile-filter-button:active {
                transform: translateY(0);
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            }
            .mobile-filter-button.active {
                background-color: #f0f0f0;
                border-color: #0366d6;
            }
            .mobile-filter-button.active svg {
            color: #0366d6;
            }
            .mobile-filter-button {
                position: fixed;
                bottom: 24px; /* Distance from bottom */
                right: 24px; /* Distance from right */
                background: white;
                border: 1px solid #ddd;
                border-radius: 50%;
                width: 48px; /* Slightly larger for better touch target */
                height: 48px; /* Slightly larger for better touch target */
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2); /* Enhanced shadow for floating effect */
                z-index: 1000;
                cursor: pointer;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            
            .mobile-filter-dropdown {
                position: fixed;
                bottom: 84px; /* Position above the filter button */
                left: 16px;
                right: 16px;
                background: white;
                padding: 16px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 999;
            }
			.mobile-dropdown {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 16px;
                background-color: white;
                appearance: none;
                -webkit-appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 12px center;
                background-size: 16px;
            }
            .mobile-filter-button.active {
                background-color: #f0f0f0;
            }

            .mobile-filter-button.active svg {
                color: #0366d6;
            }
            .mobile-court-header {
                display: flex;
                align-items: center;
                padding: 12px 0;
                cursor: pointer;
                width: 100%; /* Ensure full width */
            }

            .court-arrow {
                margin-right: 12px; /* Increase space after arrow */
                font-size: 12px;
                transition: transform 0.3s ease;
                flex-shrink: 0; /* Prevent arrow from shrinking */
            }

            .mobile-court-list {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }

            .mobile-court-item {
                padding: 8px 0;
                color: #666;
                font-size: 14px;
                border-bottom: 1px solid #eee;
            }

            .mobile-court-item:last-child {
                border-bottom: none;
            }
            .mobile-timeslot {
                position: relative;
                border-left: 5px solid transparent;
                transition: background-color 0.2s ease;
            }

            .mobile-timeslot.available {
                border-left: 5px solid rgb(52,199,89,0.5); /* Green border for available */
                background-color: rgba(52,199,89,0.03); /* Very light green background */
            }

            .mobile-timeslot.unavailable {
                border-left: 5px solid rgb(255,59,48,0.5); /* Red border for unavailable */
                background-color: rgba(255,59,48,0.03); /* Very light red background */
            }

            .mobile-time {
                font-weight: 600;
                color: #333;
            }

            .mobile-court-unavailable {
                padding: 10px 0;
                color: #666;
                font-style: italic;
            }

            .mobile-timeslot.available:active {
                background-color: rgba(52,199,89,0.1);
            }
        }
    </style>
</head>
<body>
    <div class="schedule-container">
        <!-- Desktop View -->
        <div class="navigation">
            <button class="nav-button" id="prevButton" onclick="previousWeek()">Previous Week</button>
            <button class="expandCollapseAllOff" id="expandCollapseButton" onclick="expandCollapseAll()">Expand/Collapse All</button>
            <div class="current-week" id="current-week"></div>
            <select class="dropdown" id="dropdown" onchange="applyFilter(this.value)">
                <option value="" disabled selected>Filter by court</option>
                <option value="All Courts">All courts</option>
                <option value="Alpha Auburn">Alpha Auburn</option>
                <option value="Alpha Egerton">Alpha Egerton</option>
                <option value="Alpha Slough">Alpha Slough</option>
                <option value="Roketto - Sydney Olympic Park">Roketto</option>
            </select>
            <div class="expandCollapseAllOff" id="expandCollapseAllTag" style="display: none;"></div>
            <button class="nav-button" id="nextButton" onclick="nextWeek()">Next Week</button>
        </div>
        <div class="schedule-grid" id="schedule"></div>

        <!-- Mobile View -->
        <div class="mobile-view" style="display: none;">
            <div class="mobile-header">
                <div class="mobile-nav">
                    <button class="nav-button" onclick="mobilePreviousWeek()">‚Üê</button>
                    <div class="mobile-current-date" id="mobileCurrent"></div>
                    <button class="nav-button" onclick="mobileNextWeek()">‚Üí</button>
                </div>
                <div class="mobile-dates" id="mobileDates"></div>
            </div>
            <div id="mobileSchedule"></div>
            <button class="mobile-filter-button" onclick="toggleMobileFilter()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script>
// Constants
const timeSlots = ['7:00am', '8:00am', '9:00am', '10:00am', '11:00am', '12:00pm', '1:00pm', '2:00pm', '3:00pm', '4:00pm', '5:00pm', '6:00pm', '7:00pm', '8:00pm', '9:00pm', '10:00pm', '11:00pm'];
const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

const BOOKING_URLS = {
    'Alpha Auburn': 'https://alphabadminton.yepbooking.com.au/',
    'Alpha Egerton': 'https://alphabadminton.yepbooking.com.au/',
    'Alpha Slough': 'https://alphabadminton.yepbooking.com.au/',
    'Roketto - Sydney Olympic Park': 'https://roketto.sportlogic.net.au/secure/customer/booking/v1/public/show'
};

// Global variables
let courtData;
let alphaCourts;
let dates;
let minDate;
let maxDate;
let originalcourtData;
let currentStartDate;
let selectedDay = 0; // For mobile view: 0-6 representing day of week

function getBookingUrl(location) {
    return BOOKING_URLS[location] || '#'; // Return the mapped URL or '#' if not found
}

// Fetch data from API
async function fetchBookings() {
    try {
        const response = await fetch('https://storage.googleapis.com/badminton-bookings/all_bookings.json');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching bookings:', error);
    }
}

// Initialize application
async function initialize() {
    courtData = await fetchBookings();
    originalcourtData = courtData;
    if (courtData.length > 0) {
        console.log('Bookings loaded:', courtData);
        
        // Filter out unavailable courts
        courtData = courtData.filter(court => court.Status !== "unavailable");
        
        // Get all dates from Alpha courts for determining date range
        dates = courtData
            .filter(court => court.Location.startsWith("Alpha"))
            .map(court => new Date(court.Date));
        
        minDate = new Date(Math.min(...dates));
        maxDate = new Date(Math.max(...dates));
        
        // Filter courtData to only include dates up to maxDate
        courtData = courtData.filter(court => {
            const courtDate = new Date(court.Date);
            return courtDate <= maxDate;
        });
        
        // Also filter originalcourtData
        originalcourtData = originalcourtData.filter(court => {
            const courtDate = new Date(court.Date);
            return courtDate <= maxDate;
        });
        
        currentStartDate = getStartOfWeek(minDate);
        
        console.log('Date range:', {
            minDate: minDate.toISOString(),
            maxDate: maxDate.toISOString(),
            filteredBookingsCount: courtData.length
        });
        
        createSchedule();
        initializeMobileView();
    }
}

// Date utility functions
function getStartOfWeek(date) {
    const d = new Date(date);
    const day = d.getDay();
    d.setDate(d.getDate() - day);
    return d;
}

function formatDate(date) {
    const d = new Date(date);
    return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
}

function getDateForDayIndex(startDate, dayIndex) {
    const date = new Date(startDate);
    date.setDate(date.getDate() + dayIndex);
    return date.toISOString().split('T')[0];
}

// Desktop view functions
function updateNavigationButtons() {
    const nextWeekStart = new Date(getStartOfWeek(currentStartDate));
    nextWeekStart.setDate(nextWeekStart.getDate() + 7);
    
    const prevWeekStart = new Date(getStartOfWeek(currentStartDate));
    prevWeekStart.setDate(prevWeekStart.getDate() - 7);

    document.getElementById('nextButton').disabled = nextWeekStart > maxDate;
    document.getElementById('prevButton').disabled = prevWeekStart < getStartOfWeek(minDate);
}

function updateWeekDisplay() {
    const endDate = new Date(currentStartDate);
    endDate.setDate(endDate.getDate() + 6);
    
    const weekDisplay = document.getElementById('current-week');
    weekDisplay.textContent = `${formatDate(currentStartDate)} - ${formatDate(endDate)}`;
    updateNavigationButtons();
}

function toggleCourtNumbers(element) {
    const courtNumbers = element.nextElementSibling;
    courtNumbers.classList.toggle('expanded');
    const expandIcon = element.querySelector('.expand-icon');
    expandIcon.textContent = courtNumbers.classList.contains('expanded') ? '‚ñº' : '‚ñ∂';
}

function getCourtInfo(date, time) {
    // Check if the date is beyond maxDate
    const checkDate = new Date(date);
    const maxDateCheck = new Date(maxDate);
    maxDateCheck.setHours(23, 59, 59, 999);

    if (checkDate > maxDateCheck) {
        return 'No data available';
    }

    const courts = courtData.filter(
        court => court.Date === date && court.Time === time
    );

    if (courts.length === 0) {
        return 'No courts available';
    }

    const courtsByLocation = courts.reduce((acc, court) => {
        if (!acc[court.Location]) {
            acc[court.Location] = [];
        }
        let courtNumber;
        if (court.Court.includes(' ')) {
            courtNumber = court.Court.split(' ')[1];
        } else {
            courtNumber = court.Court;
        }
        acc[court.Location].push({
            number: courtNumber,
            fullName: court.Court
        });
        return acc;
    }, {});

    return Object.entries(courtsByLocation)
        .map(([location, courtNumbers]) => {
            const count = courtNumbers.length;
            const bookingUrl = getBookingUrl(location);
            return `<div class="court-location" onclick="toggleCourtNumbers(this)">
                <span class="expand-icon">‚ñ∂</span>${location} (${count})
            </div>
            <div class="court-numbers">
                <a href="${bookingUrl}" 
                   class="court-list-link" 
                   target="_blank" 
                   rel="noopener noreferrer">
                    Courts: ${courtNumbers.map(court => 
                        `<span class="court-number">${court.number}</span>`
                    ).join(', ')}
                </a>
            </div>`;
        })
        .join('\n');
}

function createSchedule() {
    const schedule = document.getElementById('schedule');
    schedule.innerHTML = '';
    
    // Create empty top-left cell
    const emptyCell = document.createElement('div');
    emptyCell.className = 'time-header';
    emptyCell.textContent = '';
    schedule.appendChild(emptyCell);
    
    // Create header row
    days.forEach((day, index) => {
        const currentDate = new Date(currentStartDate);
        currentDate.setDate(currentDate.getDate() + index);
        
        const headerCell = document.createElement('div');
        headerCell.className = 'header-cell';
        headerCell.innerHTML = `
            ${day}
            <div class="date-subheader">${formatDate(currentDate)}</div>
        `;
        schedule.appendChild(headerCell);
    });

    // Create time slots
    timeSlots.forEach(time => {
        // Add time column cell
        const timeCell = document.createElement('div');
        timeCell.className = 'time-column';
        timeCell.textContent = time;
        schedule.appendChild(timeCell);

        // Add court info for each day
        days.forEach((day, index) => {
            const currentDate = getDateForDayIndex(currentStartDate, index);
            const checkDate = new Date(currentDate);
            const maxDateCheck = new Date(maxDate);
            maxDateCheck.setHours(23, 59, 59, 999);
            
            const timeSlotDiv = document.createElement('div');
            
            if (checkDate > maxDateCheck) {
                // Date is beyond maxDate
                timeSlotDiv.className = 'time-slot no-data';
                timeSlotDiv.innerHTML = `<div class="court-info no-data">No data available</div>`;
            } else {
                const courtInfo = getCourtInfo(currentDate, time);
                const isUnavailable = courtInfo === 'No courts available';
                timeSlotDiv.className = `time-slot ${isUnavailable ? 'unavailable' : courtInfo !== '' ? 'available' : ''}`;
                timeSlotDiv.innerHTML = `<div class="court-info">${courtInfo}</div>`;
            }
            
            schedule.appendChild(timeSlotDiv);
        });
    });

    updateWeekDisplay();
}

// Navigation functions
function nextWeek() {
    const nextWeek = new Date(currentStartDate);
    nextWeek.setDate(nextWeek.getDate() + 7);
    if (nextWeek <= maxDate) {
        currentStartDate = nextWeek;
        createSchedule();
        renderMobileDates();
        renderMobileSchedule();
    }
}

function previousWeek() {
    const prevWeek = new Date(currentStartDate);
    prevWeek.setDate(prevWeek.getDate() - 7);
    if (prevWeek >= getStartOfWeek(minDate)) {
        currentStartDate = prevWeek;
        createSchedule();
        renderMobileDates();
        renderMobileSchedule();
    }
}

// Filter functions
function applyFilter(selectedValue) {
    if (selectedValue === "") return; // Don't process empty selections
    
    // Update both desktop and mobile dropdowns to show the same selection
    const desktopDropdown = document.getElementById("dropdown");
    const mobileFilterButton = document.querySelector('.mobile-filter-button');
    
    if (selectedValue == "All Courts") {
        courtData = originalcourtData.filter(court => court.Status !== "unavailable");
        mobileFilterButton?.classList.remove('active');
    } else {
        courtData = originalcourtData.filter(court => 
            court.Status !== "unavailable" && court.Location == selectedValue
        );
        mobileFilterButton?.classList.add('active');
    }
    
    // Update the views
    if (desktopDropdown) desktopDropdown.value = selectedValue;
    dates = courtData.filter(court => court.Location.startsWith("Alpha"))
        .map(court => new Date(court.Date));
    
    // Refresh both views
    createSchedule();
    renderMobileSchedule();
}

// Mobile view functions
function initializeMobileView() {
    const isMobile = window.innerWidth <= 768;
    const mobileView = document.querySelector('.mobile-view');
    const desktopView = document.querySelector('.schedule-grid');
    const navigation = document.querySelector('.navigation');

    // Remove any open filter dropdown when switching views
    const existingFilter = document.getElementById('mobile-filter-dropdown');
    if (existingFilter) existingFilter.remove();

    if (isMobile) {
        mobileView.style.display = 'block';
        desktopView.style.display = 'none';
        navigation.style.display = 'none';
        renderMobileDates();
        renderMobileSchedule();
    } else {
        mobileView.style.display = 'none';
        desktopView.style.display = 'grid';
        navigation.style.display = 'flex';
        createSchedule();
    }
}

function renderMobileDates() {
    const mobileDates = document.getElementById('mobileDates');
    const currentDate = new Date(currentStartDate);
    
    // Update the week range in the header
    const endDate = new Date(currentDate);
    endDate.setDate(endDate.getDate() + 6);
    document.getElementById('mobileCurrent').innerHTML = 
        `${formatDate(currentDate)} - ${formatDate(endDate)}`;
    
    // Rest of the function remains the same
    mobileDates.innerHTML = '';
    for (let i = 0; i < 7; i++) {
        const date = new Date(currentDate);
        date.setDate(date.getDate() + i);
        
        const tab = document.createElement('button');
        tab.className = `date-tab ${i === selectedDay ? 'active' : ''}`;
        tab.onclick = () => selectMobileDay(i);
        
        tab.innerHTML = `
            <span class="day">${days[date.getDay()].slice(0, 3)}</span>
            <span class="date">${date.getDate()} ${months[date.getMonth()]}</span>
        `;
        
        mobileDates.appendChild(tab);
    }
}

function renderMobileSchedule() {
    const mobileSchedule = document.getElementById('mobileSchedule');
    const currentDate = new Date(currentStartDate);
    currentDate.setDate(currentDate.getDate() + selectedDay);
    const dateStr = currentDate.toISOString().split('T')[0];
    
    mobileSchedule.innerHTML = '';
    
    timeSlots.forEach(time => {
        const courts = getCourtInfoForMobile(dateStr, time);
        const timeSlot = document.createElement('div');
        timeSlot.className = 'mobile-timeslot';
        
        if (courts[0]?.isNoData) {
            timeSlot.classList.add('no-data');
            timeSlot.innerHTML = `
                <div class="mobile-time">${time}</div>
                <div class="mobile-court">
                    <div class="mobile-court-unavailable">No data available</div>
                </div>
            `;
        } else if (courts[0]?.isUnavailable) {
            timeSlot.classList.add('unavailable');
            timeSlot.innerHTML = `
                <div class="mobile-time">${time}</div>
                <div class="mobile-court">
                    <div class="mobile-court-unavailable">No courts available</div>
                </div>
            `;
        } else {
            timeSlot.classList.add('available');
            timeSlot.innerHTML = `
                <div class="mobile-time">${time}</div>
                ${formatMobileCourtInfo(courts)}
            `;
        }
        
        mobileSchedule.appendChild(timeSlot);
    });
}

function getCourtInfoForMobile(date, time) {
    // Check if the date is beyond maxDate
    const checkDate = new Date(date);
    const maxDateCheck = new Date(maxDate);
    maxDateCheck.setHours(23, 59, 59, 999);

    if (checkDate > maxDateCheck) {
        return [{
            location: 'No data available',
            count: 0,
            courts: [],
            isNoData: true
        }];
    }

    if (!courtData || !Array.isArray(courtData)) {
        return [];
    }
    
    const filtered = courtData.filter(court => court.Date === date && court.Time === time);
    
    if (filtered.length === 0) {
        return [{
            location: 'No courts available',
            count: 0,
            courts: [],
            isUnavailable: true
        }];
    }

    return filtered.reduce((acc, court) => {
        const location = court.Location;
        if (!acc.find(c => c.location === location)) {
            const courtsAtLocation = filtered.filter(c => c.Location === location);
            acc.push({
                location: location,
                count: courtsAtLocation.length,
                courts: courtsAtLocation.map(c => c.Court)
            });
        }
        return acc;
    }, []);
}

function formatMobileCourtInfo(courts) {
    return courts.map(locationData => {
        const bookingUrl = getBookingUrl(locationData.location);
        return `
        <div class="mobile-court">
            <div class="mobile-court-header" onclick="toggleCourtList(this)">
                <span class="court-arrow">‚ñ∂</span>
                <span class="mobile-court-name">${locationData.location}</span>
                <span class="mobile-court-count">(${locationData.count})</span>
            </div>
            <div class="mobile-court-list">
                <div class="mobile-court-numbers">
                    ${locationData.courts.map(court => `
                        <a href="${bookingUrl}" 
                           class="mobile-court-chip"
                           target="_blank" 
                           rel="noopener noreferrer">${court}</a>
                    `).join('')}
                </div>
            </div>
        </div>
    `}).join('');
}

function selectMobileDay(day) {
    selectedDay = day;
    document.querySelectorAll('.date-tab').forEach((tab, index) => {
        tab.classList.toggle('active', index === day);
    });
    // Remove the updateMobileCurrentDate call since we want to keep the weekly view
    renderMobileSchedule();
}

function updateMobileCurrentDate() {
    const startDate = new Date(currentStartDate);
    const endDate = new Date(currentStartDate);
    endDate.setDate(endDate.getDate() + 6);
    
    // Keep the weekly range format
    document.getElementById('mobileCurrent').textContent = 
        `${formatDate(startDate)} - ${formatDate(endDate)}`;
}

function toggleMobileFilter() {
    const dropdown = document.getElementById('dropdown');
    if (dropdown) {
        dropdown.click();
    }
}

// Event listeners
window.addEventListener('resize', initializeMobileView);
window.addEventListener('load', initialize);

// Expand/Collapse functions
function expandCollapseAll() {
    const expandCollapseAllTag = document.querySelector("#expandCollapseAllTag");
    if (expandCollapseAllTag.classList.contains("expandCollapseAllOff")) {
        expandCollapseAllTag.classList.remove("expandCollapseAllOff");
        expandCollapseAllTag.classList.add("expandCollapseAllOn");
        document.querySelectorAll('.court-numbers').forEach(div => {
            div.classList.add('expanded');
        });
    } else {
        expandCollapseAllTag.classList.remove("expandCollapseAllOn");
        expandCollapseAllTag.classList.add("expandCollapseAllOff");
        document.querySelectorAll('.court-numbers').forEach(div => {
            div.classList.remove('expanded');
        });
    }
}

function toggleCourtList(element) {
    const courtList = element.nextElementSibling;
    const arrow = element.querySelector('.court-arrow');
    
    // Toggle the visibility
    if (courtList.style.maxHeight) {
        courtList.style.maxHeight = null;
        arrow.textContent = '‚ñ∂';
    } else {
        courtList.style.maxHeight = courtList.scrollHeight + "px";
        arrow.textContent = '‚ñº';
    }
}

function mobilePreviousWeek() {
    const prevWeek = new Date(currentStartDate);
    prevWeek.setDate(prevWeek.getDate() - 7);
    if (prevWeek >= getStartOfWeek(minDate)) {
        currentStartDate = prevWeek;
        renderMobileDates();
        // Update the header with the weekly range
        const endDate = new Date(prevWeek);
        endDate.setDate(endDate.getDate() + 6);
        document.getElementById('mobileCurrent').textContent = 
            `${formatDate(prevWeek)} - ${formatDate(endDate)}`;
        renderMobileSchedule();
    }
}

function mobileNextWeek() {
    const nextWeek = new Date(currentStartDate);
    nextWeek.setDate(nextWeek.getDate() + 7);
    if (nextWeek <= maxDate) {
        currentStartDate = nextWeek;
        renderMobileDates();
        // Update the header with the weekly range
        const endDate = new Date(nextWeek);
        endDate.setDate(endDate.getDate() + 6);
        document.getElementById('mobileCurrent').textContent = 
            `${formatDate(nextWeek)} - ${formatDate(endDate)}`;
        renderMobileSchedule();
    }
}

function toggleMobileFilter() {
    const existingFilter = document.getElementById('mobile-filter-dropdown');
    if (existingFilter) {
        existingFilter.remove();
        return;
    }

    const filterContainer = document.createElement('div');
    filterContainer.id = 'mobile-filter-dropdown';
    filterContainer.className = 'mobile-filter-dropdown';
    
    const select = document.createElement('select');
    select.className = 'mobile-dropdown';
    select.onchange = function() {
        applyFilter(this.value);
        toggleMobileFilter(); // Close the filter after selection
    };

    // Add the same options as desktop
    const options = [
        { value: '', text: 'Filter by court' },
        { value: 'All Courts', text: 'All courts' },
        { value: 'Alpha Auburn', text: 'Alpha Auburn' },
        { value: 'Alpha Egerton', text: 'Alpha Egerton' },
        { value: 'Alpha Slough', text: 'Alpha Slough' },
        { value: 'Roketto - Sydney Olympic Park', text: 'Roketto' }
    ];

    options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.text = option.text;
        if (option.value === '') opt.disabled = true;
        if (option.value === '') opt.selected = true;
        select.appendChild(opt);
    });

    filterContainer.appendChild(select);
    document.querySelector('.mobile-header').appendChild(filterContainer);
}

    </script>
</body>
</html>
